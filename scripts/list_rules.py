import argparse
import os
import json
from pprint import pprint


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("rules_path")
    parser.add_argument("--rules_sub_path", required=False)
    args = parser.parse_args()

    bad_files = []
    json_to_list = []
    # add rules to list
    root = f"{args.rules_path}/{args.rules_sub_path}" if args.rules_sub_path else args.rules_path
    for subdir, dirs, files in os.walk(root):
        for file in files:
            with open(os.path.join(subdir, file)) as f:
                try:
                    json_to_list.append(json.loads(f.read()))
                except Exception as e:
                    bad_files.append({os.path.join(subdir, file): str(e)})

    with open('output_rules_list.json', 'w') as f:
        json.dump(json_to_list, f, indent=4)

    if bad_files:
        print("Bad files found while creating list:")
        pprint(bad_files)


if __name__ == "__main__":
    main()
