import argparse
import os

import orjson
from jsonschema import validate


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("rules_path")
    parser.add_argument("schema_path")
    args = parser.parse_args()

    # load rules and schema
    with open(f"{args.schema_path}/json_schema.json") as f:
        schema = orjson.loads(f.read())

    rules = []
    for location in os.listdir(args.rules_path):
        with open(f"{args.rules_path}/{location}") as f:
            rules.append(orjson.loads(f.read()))

    # check rules
    for r in rules:
        validate(instance=r, schema=schema)


if __name__ == "__main__":
    main()
