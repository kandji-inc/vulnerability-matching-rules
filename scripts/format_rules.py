import argparse
import os
import json
from pprint import pprint


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("rules_path")
    args = parser.parse_args()

    bad_files = []
    # format rules
    for subdir, dirs, files in os.walk(args.rules_path):
        for file in files:
            with open(os.path.join(subdir, file), "r+") as f:
                try:
                    formatted_string = json.dumps(json.loads(f.read()), indent=4)
                    f.seek(0)
                    f.write(formatted_string)
                except Exception as e:
                    bad_files.append({os.path.join(subdir, file): str(e)})

    if bad_files:
        print("Bad files found while formatting:")
        pprint(bad_files)


if __name__ == "__main__":
    main()
